<html>
<head>
  <title>Genshin WebCards</title>
  <link rel="shortcut icon" href="data/titleImg.jfif">
<style type="text/css">

:root {
    --scaling: 0.7;
    --background-color: #333;
}

@font-face {
  font-family: myFirstFont;
  src: url(data/ja-jp.ttf);
}

body {
  background: rgb(51,51,51);
background: linear-gradient(180deg, rgba(51,51,51,1) 0%, rgba(20,22,79,1) 100%);
  text-align: center;
  margin: 0;
}

.title {
  margin-top: 10vh;
  font-family: myFirstFont;
  font-size: 2em;
  color: white;
}

.bgimg {
  background-image: url('images/card/permanent/a_new_world.png');
  width: calc(84vw * var(--scaling));
  height: calc(40vw * var(--scaling));
  background-size: cover;
  display: inline-block;
  overflow: hidden;
  text-align: left;
  border-style: inset;
}

.avt_pic_class {
  background-image: url('images/char/traveler_aether.png');
  --size: 17.5vw;
  --half_size: calc(var(--size) * 0.5);
  width: calc(17.5vw * var(--scaling));
  height: calc(17.5vw * var(--scaling));
  position: absolute;
  margin: auto;
  top: calc((8.8vw - var(--half_size))  * var(--scaling));
  left: calc(-1.6vw * var(--scaling));
  right: 0;
  bottom: 0;
  background-size: cover;
}

.ui-corner-all {
  -moz-border-radius: 50%; 
  -webkit-border-radius: 50%; 
  border-radius: 50%; 
  border: 0.6vw solid rgb(236, 229, 216);
  background: #DD8F5D; 
  width: 100%; 
  height: 35%; 
  overflow: hidden;
  position: relative;
  cursor: pointer;
  }


.char_avatar {
  margin-left: calc(6.1vw * var(--scaling));
  /* margin-right: calc(5vw * var(--scaling)); */
  width: 17.0%;
  padding-top: calc(4.2vw * var(--scaling));
  height: calc(100%);
  display: inline-block;
  float: left;
}

.infos {
  --left-bord: calc(7.0vw * var(--scaling)); 
  height: 100%;
  display: inline-block;
  padding-left: var(--left-bord);
  width: calc(100% - 17.5% - 5.7vw * var(--scaling) - var(--left-bord));
}

.name {
    font-family: myFirstFont;
    color: rgb(236, 229, 216)   ;
    font-size: calc(4.5vw * var(--scaling));
    margin-top: calc(4vw * var(--scaling));
    margin-right: calc(2vw * var(--scaling));
    background: rgb(255,255,255);
    background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(0,0,0,0.06235997817095584) 4%, rgba(0,0,0,0.06235997817095584) 96%, rgba(255,255,255,0) 100%);
}

.phrase {
    font-family: myFirstFont;
    color: rgb(236, 229, 216)   ;
    font-size: calc(2.84vw * var(--scaling));
    margin-top: calc(1.6vw * var(--scaling));
    margin-right: calc(3.3vw * var(--scaling));
}

/* The Modal (background) */
.modal {
  font-family: myFirstFont;
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background: rgb(88,152,185);
  background: linear-gradient(180deg, rgba(88,152,185,1) 0%, rgba(52,34,157,1) 100%);
  width: 100%;
  height: 90%;
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  overflow-y: scroll;
  border-radius: 20px;
  box-sizing:border-box;
  border: 2px dotted black;
}

.modal-window {
    background-color: rgb(217, 215, 233);
    color: rgb(227, 244, 255);
    width: 80%;
    height: 70%;
    margin: auto;
    padding: 20px;
    border-radius: 20px;
    overflow: auto;
}
/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.topnav {
  /* overflow: hidden; */
  background-color: var(--background-color);
  cursor: default;
  margin: 0 auto;
  font-family: myFirstFont;
}

.topnav a {
  float: left;
  display: block;
  color: #f2f2f2;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 17px;
}

.active {
  background-color: #04AA6D;
  color: white;
}

.topnav .icon {
  display: none;
}

.dropdown {
  float: left;
  overflow: hidden;
}

.dropdown .dropbtn {
  font-size: 17px;    
  border: none;
  outline: none;
  color: white;
  padding: 14px 16px;
  background-color: inherit;
  font-family: inherit;
  margin: 0;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content .dropdown-item {
  float: none;
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.topnav a:hover, .dropdown:hover .dropbtn {
  background-color: #555;
  color: white;
}

.dropdown-content .dropdown-item:hover {
  background-color: #ddd;
  color: black;
}

.dropdown:hover .dropdown-content {
  display: block;
}

::-webkit-scrollbar {
    /* // Width of vertical scroll bar */
    width: 8px;
    /* // Height of horizontal scroll bar */
    height: 10px;

  }
  ::-webkit-scrollbar-thumb {
    border-radius: 8px;
    background: #c2c9d2;
  }

::-webkit-scrollbar-button:end:increment {
    height: 3%;
    display: block;
    background: transparent;
}

::-webkit-scrollbar-button:start:increment {
    height: 3%;
    display: block;
    background: transparent;
}


.topnav-container {
  width: 100%;
  display: flex;
  justify-content: center;
  background-color: var(--background-color);
}
</style>

<body>
  <div class="topnav-container">
    <div class="topnav" id="myTopnav">
      <div class="dropdown">
        <button class="dropbtn">Visibilidade  
          <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-content" id="visibilityDropdown">
          <label  class="dropdown-item"><input type="checkbox" id="checkboxName"  onclick="handleCheckbox()" checked> Nome</label>
          <label  class="dropdown-item"><input type="checkbox" id="checkboxPhrase" onclick="handleCheckbox()" checked> Assinatura</label>
          <label  class="dropdown-item"><input type="checkbox" id="checkboxIcon" onclick="handleCheckbox()" checked> Avatar</label>
        </div>
      </div>
      <a onclick="openChar()">Avatar</a>
      <div class="dropdown">
        <button class="dropbtn">Cartões
          <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-content">
          <a onclick="openCardChar()" class="dropdown-item">Cartões de Personagens</a>
          <a onclick="openCardPermanent()" class="dropdown-item">Cartões Permanentes</a>
          <a onclick="openCardEvent()" class="dropdown-item">Cartões de Eventos</a>
          <a onclick="openCardReputation()" class="dropdown-item">Cartões de Reputação</a>
          <a onclick="openCardAchievement()" class="dropdown-item">Cartões de Conquistas</a>
          <a onclick="openCardBattlepass()" class="dropdown-item">Cartões do Passe de Batalha</a>
        </div>
      </div>
      <a onclick="getNameInput()">Nome</a>
      <a onclick="getPhraseInput()">Assinatura</a> 
      <a onclick="downloadNamecard()">Download do cartão</a>
    </div>
  </div>

  <h1 class="title"> Cartão gerado</h1>
  <div class="bgimg" id="card_pic" >
    <div class="char_avatar">
        <div class="ui-corner-all" onclick="openChar()" id="char_icon">
            <div class="avt_pic_class" id="avt_pic"></div>
        </div>  
    </div>
    <div class="infos">
        <div class="name" id="name_field"> Aether </div>
        <div class="phrase" id="phrase_field"> Sem assinatura </div>
    </div>
</div>

<!-- The Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
    <div class="modal-window">
        <div style="width: 100%;">
            <span class="close">&times;</span>
        </div>
        <div class="modal-content" id="modalContent">
        </div>
    </div>
</div>

<script src="data/html2canvas.min.js"></script>

<script>
  function handleCheckbox() {
    let checkboxName = document.getElementById("checkboxName");
    let checkboxPhrase = document.getElementById("checkboxPhrase");
    let checkboxIcon = document.getElementById("checkboxIcon");
    let binString = "".concat((+ checkboxIcon.checked).toString(), (+ checkboxName.checked).toString(), (+ checkboxPhrase.checked).toString())
    current_visibilities = binString;
    updateHash();
    updateThroughHash();
  }
</script>

<script>

  function getNameInput() {
    var name = window.prompt("Digite o nome desejado: ");
    let checkboxName = document.getElementById("checkboxName");
    if (!name) {
      return;
    }
    current_name = encodeURI(name);
    checkboxName.checked = true;
    handleCheckbox();
  }

  function getPhraseInput() {
    var phrase = window.prompt("Digite a frase desejada: ");
    let checkboxPhrase = document.getElementById("checkboxPhrase");
    if (!phrase) {
      return;
    }
    current_phrase = encodeURI(phrase);
    checkboxPhrase.checked = true;
    handleCheckbox();
  }

  function downloadNamecard() {
      html2canvas(document.querySelector("#card_pic")).then(canvas => {
          var resized_canvas = document.createElement('canvas');
          resized_canvas.width = 840;
          resized_canvas.height = 400;
          var context = resized_canvas.getContext('2d');
          context.drawImage(canvas, 0, 0, 840, 400);
          var link = document.createElement('a');
          link.download = 'Genshin-Namecard.png';
          link.href = resized_canvas.toDataURL()
          link.click();
      }); 
    }

</script>
<script src="data/jquery.min.js"></script>
<script>
// Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

function updateHash() {
  let hash = "".concat("id=", current_card_type, current_card, current_char, "&name=", current_name,
                       "&phrase=", current_phrase, "&visibility=" + current_visibilities);
  window.location.hash = '#' + hash;
}

function addChar(index) {
    let name = characters[index][0];
    let pic_name = characters[index][1];
    if (!pic_name) {
        pic_name = name;
    }
    pic_name = pic_name.toLowerCase()
    var div = document.createElement("div");
    div.style.width = "15%";
    div.style.minWidth = "100px";
    div.style.height = "auto";
    div.style.textAlign = "Center";
    div.style.display = "inline-block";
    div.style.marginRight = "30px";
    div.style.marginLeft = "30px";
    div.style.margin = "30px";

    var pic = document.createElement("img");
    pic.src = "images/char/" + pic_name + ".png";
    pic.style.width = "100%";
    pic.style.background = "#DD8F5D";
    pic.onclick = function(){
      let local_index = index;
      return function() {
        let modal = document.getElementById("myModal");
        modal.style.display = "none";
        hexString = local_index.toString(16);
        if (hexString.length == 1) {
          hexString = "0".concat(hexString);
        }
        current_char = hexString;
        updateHash();
        updateThroughHash();
      };
    }();

    pic.style.cursor = "hand";
    pic.style.outline = "2px solid black";
    pic.color = "#DD8F5D";

    div.appendChild(pic);
    div.appendChild(document.createTextNode(name));

    parent = document.getElementById("modalContent");
    parent.appendChild(div)
};

function addCard(folder_index, card_index) {
    folder = all_cards_categories[folder_index];
    name = all_cards[folder_index][card_index][0];
    pic_name = all_cards[folder_index][card_index][1];
    if (!pic_name) {
        pic_name = name;
    }
    pic_name = pic_name.toLowerCase();
    var div = document.createElement("div");
    div.style.width = "25%";
    div.style.minWidth = "100px";
    div.style.height = "auto";
    div.style.textAlign = "Center";
    div.style.display = "inline-block";
    div.style.marginRight = "30px";
    div.style.marginLeft = "30px";
    div.style.margin = "30px";

    var pic = document.createElement("img");
    pic.src = "images/card/" + folder + "/" + pic_name + ".png";
    pic.style.width = "100%";
    pic.onclick =  function(){
      let local_folder_index = folder_index;
      let local_card_index = card_index;
      return function() {
        let modal = document.getElementById("myModal");
        modal.style.display = "none";
        folderHexString = folder_index.toString(16);
        cardHexString = card_index.toString(16);
        if (cardHexString.length == 1) {
          cardHexString = "0".concat(cardHexString);
        }
        current_card_type = folderHexString;
        current_card = cardHexString;
        updateHash();
        updateThroughHash();
      };
    }();

    pic.style.cursor = "hand";
    pic.style.outline = "2px solid black";

    div.appendChild(pic);
    div.appendChild(document.createTextNode(name));

    parent = document.getElementById("modalContent");
    parent.appendChild(div)
};

var characters = [["Albedo"], ["Amber"], ["Barbara"], ["Beidou"], ["Bennet"],
                      ["Chongyun"], ["Diluc"], ["Diona"], ["Eula"], ["Fischl"],
                      ["Ganyu"], ["Hu Tao", "HuTao"], ["Jean"], ["Kaedehara Kazuha", "Kazuha"],
                      ["Kaeya"], ["Keqing"], ["Klee"], ["Lisa"], ["Mona"], ["Ningguang"],
                      ["Noelle"], ["Qiqi"], ["Razor"], ["Rosaria"], ["Sucrose"], ["Tartaglia"],
                      ["Traveler/Aether", "Traveler_aether"], ["Traveler/Lumine", "Traveler_lumine"], 
                      ["Venti"], ["Xiangling"], ["Xiao"], ["Xingqiu"], ["Xinyan"], ["Yanfei"], ["Zhongli"]];
        
// When the user clicks the button, open the modal 
function openChar() {
    $('#modalContent').empty();
    modal.style.display = "block";
    
    for (let i = 0; i < characters.length; i+=1) {
        addChar(i);
    }
}

var cardsChars =  [["Albedo"], ["Amber"], ["Barbara"], ["Beidou"], ["Bennet"],
                 ["Chongyun"], ["Diluc"], ["Diona"], ["Eula"], ["Fischl"],
                 ["Ganyu"], ["Hu Tao", "HuTao"], ["Jean"], ["Kaedehara Kazuha", "Kazuha"],
                 ["Kaeya"], ["Keqing"], ["Klee"], ["Lisa"], ["Mona"], ["Ningguang"],
                 ["Noelle"], ["Qiqi"], ["Razor"], ["Rosaria"], ["Sucrose"], ["Tartaglia"],
                 ["Venti"], ["Xiangling"], ["Xiao"], ["Xingqiu"], ["Xinyan"], ["Yanfei"], ["Zhongli"]];

var cardsPermanent = [["A New World", "A_New_World"], ["Frostbearing Ancient Tree", "Frostbearing_Ancient_Tree"]];

var cardsEvent = [["Hypostasis"], ["Lantern Light", "Lantern-Light"], ["Mechanicus"], ["Fruit of Wisdom", "Fruit_of_Wisdom"], 
                 ["Peekaboo"], ["Vastness"], ["Kaboomball"], ["Battlesong"]];

var cardsReputation = [["Mondstadt: Hero's Fame", "Mondstadt_Heros_Fame"], ["Mondstadt: Blessing", "Mondstadt_Blessing"],
                 ["Liyue: A Thousand Ships", "Liyue_A_Thousand_Ships"], ["Liyue: In the Clouds", "Liyue_In_the_Clouds"]];

var cardsAchievement = [["Bowmaster"], ["Challenger"], ["Challenger II", "Challenger_II"], ["Challenger III", "Challenger_III"],
                 ["Cliffhanger"], ["Colors of the Rainbow", "Colors_of_the_Rainbow"], ["Deep & Dark", "Deep_Dark"],
                 ["Explorer"], ["Hero"], ["Hill Dwellers", "Hill_Dwellers"], ["Reunion"], ["Snowy Land", "Snowy_Land"],
                 ["Tea Time", "Tea_Time"], ["Vacation Home", "Vacation_Home"], ["Virtuoso"],
                 ["Liyue: Stillness of Stone", "Liyue_Stillness_of_Stone"], ["Mondstadt: Whistling Wind", "Mondstadt_Whistling_Wind"]];

var cardsBattlepass = [["Catch the Wind", "Catch_the_Wind"], ["Fading Star", "Fading_Star"], ["Chalk"], ["Mingxiao"],
                 ["Windblume"], ["Sub-Space Recreation", "Sub-space_Recreation"], ["Midsummer"]];

function openCardChar() {
    $('#modalContent').empty();
    modal.style.display = "block";

    for (let i = 0; i < cardsChars.length; i+=1) {
        addCard(2, i);
    }
}

function openCardPermanent() {
    $('#modalContent').empty();
    modal.style.display = "block";

    for (let i = 0; i < cardsPermanent.length; i+=1) {
        addCard(4, i);
    }
}

function openCardEvent() {
    $('#modalContent').empty();
    modal.style.display = "block";

    for (let i = 0; i < cardsEvent.length; i+=1) {
        addCard(3, i);
    }
}


function openCardReputation() {
    $('#modalContent').empty();
    modal.style.display = "block";

    for (let i = 0; i < cardsReputation.length; i+=1) {
        addCard(5, i);
    }
}

function openCardAchievement() {
    $('#modalContent').empty();
    modal.style.display = "block";

    for (let i = 0; i < cardsAchievement.length; i+=1) {
        addCard(0, i);
    }
}


function openCardBattlepass() {
    $('#modalContent').empty();
    modal.style.display = "block";

    for (let i = 0; i < cardsBattlepass.length; i+=1) {
        addCard(1, i);
    }
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>

</body>
<script>
  current_char = "1a"     // Aether
  current_card_type = "4" // Permanent card
  current_card = "00"     // Begginer card
  current_name = "Aether"
  current_phrase = "Sem assinatura"
  current_visibilities = "111"
  all_cards_categories = ["achievement", "battlepass", "char", "event", "permanent", "reputation"]
  all_cards = [cardsAchievement, cardsBattlepass, cardsChars, cardsEvent, cardsPermanent, cardsReputation]

  function updateThroughHash() {
    var hash = window.location.hash.substr(1);
    var result = hash.split('&').reduce(function (res, item) {
        var parts = item.split('=');
        res[parts[0]] = parts[1];
        return res;
    }, {});

    if (result.id) {
      let card_type = result.id.substring(0,1);
      let card_id = result.id.substring(1,3);
      let char_id = result.id.substring(3,5);
      current_card_type = card_type;
      current_card = card_id;
      current_char = char_id;
    }  
    let selected_char = characters[parseInt(Number("0x" + current_char, 10))]
    let char_pic_name = selected_char[1];
    if (!selected_char[1]) {
      char_pic_name = selected_char[0];
    }
    char_pic_name = char_pic_name.toLowerCase();

    src = "images/char/" + char_pic_name + ".png";
    var card_pic = document.getElementById("avt_pic");
    card_pic.style.backgroundImage = "url('" + this.src + "')";

    let selected_card = all_cards[parseInt(Number("0x" + current_card_type, 10))][parseInt(Number("0x" + current_card, 10))];
    let card_pic_name = selected_card[1];
    if (!selected_card[1]) {
      card_pic_name = selected_card[0];
    }
    card_pic_name = card_pic_name.toLowerCase();

    src = "images/card/" + all_cards_categories[parseInt(Number("0x" + current_card_type, 10))] +
          "/" + card_pic_name + ".png";
    var card_pic = document.getElementById("card_pic");
    card_pic.style.backgroundImage = "url('" + this.src + "')";
    
    if (result.name) {
      current_name = result.name;
    }
    let name_div = document.getElementById("name_field");
    name_div.textContent = decodeURI(current_name);

    if (result.phrase !== undefined) {
      current_phrase = result.phrase;
    }
    let phrase_div = document.getElementById("phrase_field");
    phrase_div.textContent = decodeURI(current_phrase);

    if (result.visibility !== undefined) {
      current_visibilities = result.visibility;
    }
    let icon_div = document.getElementById("char_icon");
    let checkboxName = document.getElementById("checkboxName");
    let checkboxPhrase = document.getElementById("checkboxPhrase");
    let checkboxIcon = document.getElementById("checkboxIcon");

    icon_div.style.visibility = current_visibilities[0] == 1 ? "visible" : "hidden";
    name_div.style.visibility = current_visibilities[1] == 1 ? "visible" : "hidden";
    phrase_div.style.visibility = current_visibilities[2] == 1 ? "visible" : "hidden";
    checkboxIcon.checked = parseInt(current_visibilities[0]);
    checkboxName.checked = parseInt(current_visibilities[1]);
    checkboxPhrase.checked = parseInt(current_visibilities[2]);
  }

  updateThroughHash();
    
  // Close the dropdown if the user clicks outside of it
  window.onclick = function(event) {
    if (!event.target.matches('.dropbtn')) {
      var dropdowns = document.getElementsByClassName("dropdown-content");
      var i;
      for (i = 0; i < dropdowns.length; i++) {
        var openDropdown = dropdowns[i];
        if (openDropdown.classList.contains('show')) {
          openDropdown.classList.remove('show');
        }
      }
    }
  }
</script>
</html>